<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · MuladdMacro.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/MuladdMacro/stable/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="assets/logo.png" alt="MuladdMacro.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>MuladdMacro.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Tutorials-and-Documentation"><span>Tutorials and Documentation</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#Broadcasting"><span>Broadcasting</span></a></li><li><a class="tocitem" href="#Limitations"><span>Limitations</span></a></li><li><a class="tocitem" href="#Credit"><span>Credit</span></a></li></ul></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/MuladdMacro.jl/blob/master/README.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="MuladdMacro.jl"><a class="docs-heading-anchor" href="#MuladdMacro.jl">MuladdMacro.jl</a><a id="MuladdMacro.jl-1"></a><a class="docs-heading-anchor-permalink" href="#MuladdMacro.jl" title="Permalink"></a></h1><p><a href="https://julialang.zulipchat.com/#narrow/stream/279055-sciml-bridged"><img src="https://img.shields.io/static/v1?label=Zulip&amp;message=chat&amp;color=9558b2&amp;labelColor=389826" alt="Join the chat at https://julialang.zulipchat.com #sciml-bridged"/></a> <a href="https://docs.sciml.ai/MuladdMacro/stable/"><img src="https://img.shields.io/badge/docs-SciML-blue.svg" alt="Global Docs"/></a></p><p><a href="https://codecov.io/gh/SciML/MulAddMacro.jl?branch=master"><img src="https://codecov.io/gh/SciML/MulAddMacro.jl/branch/master/graph/badge.svg" alt="codecov"/></a> <a href="https://github.com/SciML/MulAddMacro.jl/actions?query=workflow%3ACI%20branch%3Amaster"><img src="https://github.com/SciML/MulAddMacro.jl/workflows/CI/badge.svg?branch=master" alt="Build Status"/></a></p><p><a href="https://github.com/SciML/ColPrac"><img src="https://img.shields.io/badge/ColPrac-Contributor&#39;s%20Guide-blueviolet" alt="ColPrac: Contributor&#39;s Guide on Collaborative Practices for Community Packages"/></a> <a href="https://github.com/SciML/SciMLStyle"><img src="https://img.shields.io/static/v1?label=code%20style&amp;message=SciML&amp;color=9558b2&amp;labelColor=389826" alt="SciML Code Style"/></a></p><p>This package provides the <code>@muladd</code> macro. It automatically converts expressions with multiplications and additions or subtractions to calls with <code>muladd</code> which then fuse via FMA when it would increase the performance of the code. The <code>@muladd</code> macro can be placed on code blocks and it will automatically find the appropriate expressions and nest muladd expressions when necessary. In mixed expressions summands without multiplication  will be grouped together and evaluated first but otherwise the order of evaluation of multiplications and additions is not changed.</p><h2 id="Tutorials-and-Documentation"><a class="docs-heading-anchor" href="#Tutorials-and-Documentation">Tutorials and Documentation</a><a id="Tutorials-and-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorials-and-Documentation" title="Permalink"></a></h2><p>For information on using the package, <a href="https://docs.sciml.ai/MuladdMacro/stable/">see the stable documentation</a>. Use the <a href="https://docs.sciml.ai/MuladdMacro/dev/">in-development documentation</a> for the version of the documentation, which contains the unreleased features.</p><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><pre><code class="language-julia-repl hljs">julia&gt; using MuladdMacro

julia&gt; @macroexpand(@muladd k3 = f(t + c3*dt, @. uprev+dt*(a031*k1+a032*k2)))
:(k3 = f((muladd)(c3, dt, t), (muladd).(dt, (muladd).(a032, k2, (*).(a031, k1)), uprev)))

julia&gt; @macroexpand(@muladd integrator.EEst = integrator.opts.internalnorm((update - dt*(bhat1*k1 + bhat4*k4 + bhat5*k5 + bhat6*k6 + bhat7*k7 + bhat10*k10))./ @. (integrator.opts.abstol+max(abs(uprev),abs(u))*integrator.opts.reltol)))
:(integrator.EEst = integrator.opts.internalnorm((muladd)(-dt, (muladd)(bhat10, k10, (muladd)(bhat7, k7, (muladd)(bhat6, k6, (muladd)(bhat5, k5, (muladd)(bhat4, k4, bhat1 * k1))))), update) ./ (muladd).(max.(abs.(uprev), abs.(u)), integrator.opts.reltol, integrator.opts.abstol)))</code></pre><h2 id="Broadcasting"><a class="docs-heading-anchor" href="#Broadcasting">Broadcasting</a><a id="Broadcasting-1"></a><a class="docs-heading-anchor-permalink" href="#Broadcasting" title="Permalink"></a></h2><p>A <code>muladd</code> call will be broadcasted if both the <code>*</code> and the <code>+</code> or <code>-</code> are broadcasted. If either one is not broadcasted, then the expression will be converted to a non-dotted <code>muladd</code>.</p><h2 id="Limitations"><a class="docs-heading-anchor" href="#Limitations">Limitations</a><a id="Limitations-1"></a><a class="docs-heading-anchor-permalink" href="#Limitations" title="Permalink"></a></h2><p>Currently, <code>@muladd</code> handles only explicit calls of <code>+</code> and <code>*</code>. In particular, assignments using <code>+=</code> or literal power such as <code>^2</code> are not supported. Thus, you need to rewrite them, e.g.</p><pre><code class="language-julia-repl hljs">julia&gt; using MuladdMacro

julia&gt; a = 1.0; b = 2.0; c = 3.0;

julia&gt; @macroexpand @muladd a += b * c # does not work
:(a += b * c)

julia&gt; @macroexpand @muladd a = a + b * c # good alternative
:(a = (muladd)(b, c, a))

julia&gt; @macroexpand @muladd a + b^2 # does not work
:(a + b ^ 2)

julia&gt; @macroexpand @muladd a + b * b # good alternative
:((muladd)(b, b, a))</code></pre><h2 id="Credit"><a class="docs-heading-anchor" href="#Credit">Credit</a><a id="Credit-1"></a><a class="docs-heading-anchor-permalink" href="#Credit" title="Permalink"></a></h2><p>Most of the credit goes to @fcard and @devmotion for building the first version and greatly refining the macro. These contributions are not directly shown as this was developed in Gitter chats and in the DiffEqBase.jl repository, but these two individuals did almost all of the work.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Tuesday 25 October 2022 00:32">Tuesday 25 October 2022</span>. Using Julia version 1.8.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
